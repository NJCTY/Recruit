<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>申请报名</title>

    <!-- Bootstrap -->
    <link href="__ROOT__/css/bootstrap.min.css" rel="stylesheet">
    <link href="__ROOT__/css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrap">
      <!-- 导航栏 -->
      <nav class="navbar navbar-default navbar-inverse">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">个人中心</span>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav second-nav">
        <li class="nav-contain active"><a href="__URL__/changeDepartment" class="nav-link">申请报名</a></li>
        <li class="nav-contain"><a href="__URL__/changeInfo" class="nav-link">修改信息</a></li>
        <li class="nav-contain"><a href="__URL__/changePassword" class="nav-link">修改密码</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

      <div class="container tablecontain" id="main" >
          <div id="chooseAsso">
            <span>社团:</span>
            <select class="form-control tSelector" id="teamselect">
              <option>==请选择==</option>
              <option>科协</option>
              <option>外联</option>
              <option>办公室</option>
              <option>4</option>
              <option>5</option>
          </select>
          <button type="button" class="btn btn-default" id="depAdd">添加</button>
          </div>
          <div id="chooseTable">
            <!-- <button type="button" class="btn btn-default" id="depSave">保存</button> -->
            <div class="depWrap">
              <div class="depTable">
                <span>部门1</span>
                <select class="form-control tSelector" id="department_1">
                    
                    </select>
              </div>
              <div class="depTable">
                <span>部门2</span>
                <select class="form-control tSelector" id="department_2">
                      
                    </select>
              </div>
            </div>
            <form id="questTable">
              <div class="form-group">
                  <label for="ans1" id="quest1" class="quest">问题一:</label>
                  <input type="text" class="form-control" id="ans1" placeholder="">
              </div>
              <div class="form-group">
                  <label for="ans2" id="quest2" class="quest">问题二:</label>
                  <input type="text" class="form-control" id="ans2" placeholder="">
              </div>
              <div class="form-group">
                  <label for="ans3" id="quest3" class="quest">问题三:</label>
                  <input type="text" class="form-control" id="ans3" placeholder="">
              </div>
          </form>
          <button type="button" class="btn btn-default" id="depSave">保存</button>
          </div>
          <table class="table">
              <thead>
                <tr>
                  <th>社团</th>
                  <th>部门1</th>
                  <th>部门2</th>
                  <th>录取状态</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <!-- <tr>
                  <th>
                    科协
                  </th>
                  <th>
                    网络部
                  </th>
                  <th>
                    电子部
                  </th>
                  <th>#</th>
                  <th><div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                    <button type="button" class="btn btn-default" id="depChange">修改</button>
                    <button type="button" class="btn btn-default" id="depDelet">删除</button>
                  </div></th>
                </tr> -->
              </tbody>
          </table>
      </div> <!-- /container -->
    </div>
    <div class="footer">
      <div class="container bottom">
      <p class="test-muted">&copy; 校科协</p>
    </div>
    </div>
    <script src="__ROOT__/js/jquery-1.11.2.min.js"></script>
    <script src="__ROOT__/js/bootstrap.min.js"></script>
    <!--<script src="../../../../public/js/ajax.js"></script>-->

<script>
// 预加载相关信息
function preAdd(){

}
// 生成部门选项组
function teamSelector(){
  // 社团及部门数组
  var teamNum = ['科协','外联','办公室'];
  var teamDepartment = [];
  teamDepartment[0] = ['电子部','计算机部','网络部'];
  teamDepartment[1] = ['b1','b2','b3'];
  teamDepartment[2] = ['c1','c2','c3'];
  // 社团问题
  var questArr = [];
    questArr[0] = ['a?','b?','c?'];
    questArr[1] = ['d','e','f'];

  // 更新函数
  function update(num) {
    $(".questcontent").remove();
    if($('#teamselect').val() == '==请选择=='){
      newoption = '';
      $("#chooseTable").css("display","none");
    } else {
      // $("#chooseTable").css("display","block");
      for(var i = 0,newoption = '';i<teamDepartment[num].length;i++){
        newoption += "<option class='choice'>" + teamDepartment[num][i] + "</option>";
        }
      for(var s = 0; s < 3; s++){
      $("#quest" + (s+1)).append("<span class='questcontent'>" + questArr[num][s] + "</span>");
      }
    }
    var newSelect_1 = "<select class='form-control tSelector' id='department_1'>" + newoption + "</select>";
    $('#department_1').replaceWith(newSelect_1);
    var newSelect_2 = "<select class='form-control tSelector' id='department_2'>" + newoption + "</select>";
    $('#department_2').replaceWith(newSelect_2);
    // 更新问题
    

  }
    // 检测变化
  $('#teamselect').change(function(){
    var team = $('#teamselect').val();
    // 检测社团
    for(var i = 0;i<teamNum.length;i++){
      if(teamNum[i] == team){
        break;
      }
    } 
    update(i);
  });
}
// 新增部门及修改后的保存
function addTeam(){
  $("#depSave").click(function(){
    var association = $("#teamselect").val();
    var department1 = $("#department_1").val();
    var department2 = $("#department_2").val();
    var quest1 = $("#ans1").val();
    var quest2 = $("#ans2").val();
    var quest3 = $("#ans3").val();
    var url = "{:U('Home/User/doRegAssociation')}";
    if($("#teamselect").val() == "==请选择=="){
      alert("请选择一个社团");
    } else if (!quest1||!quest2||!quest3) {
      alert("请先回答问题");
    } else {
      $.ajax({
        type : "POST",
        url : url,
        dataType : "json",
        data : {
            "association" : association,
            "department1" : department1,
            "department2" : department2,
            "quest1" : quest1,
            "quest2" : quest2,
            "quest3" : quest3
        },
        success : function(back){
              // appendDepInfo();//测试位置
              if(back.status == 1){
                console.log(back);
                appendDepInfo();//正常调用位置
                //location.reload();
              } else {
                alert(back.info);
              }
            },
        error : function(){
              alert("异常");
            }
        // 发送请求数据，接收回调数据，反映在界面中
      });
    }
    function appendDepInfo() {
      var asso = $("#teamselect").val();
      var dep1 = $("#department_1").val();
      var dep2 = $("#department_2").val();
      var content = "<tr><th>" + asso + "</th><th>" + dep1 + "</th><th>" + dep2 + "</th><th>#</th><th><div class='btn-group btn-group-sm' role='group' aria-label='Small button group'><button type='button' class='btn btn-default' id='depChange'>修改</button><button type='button' class='btn btn-default' id='depDelet'>删除</button></div></th></tr>"
      $("tbody").append(content);
    }
    <?php
    echo $res;
    ?>
  });
}
// 根据所选社团显示部门及问题
function showTeam(){
  $("#depAdd").click(function(){
    if($("#teamselect").val() == "==请选择=="){
      $("#chooseTable").css("display","none");
      alert("请先选择一个社团");
    } else {
      $("#chooseTable").css("display","block");
    }
  })
}
// 更改部门
function changeDep() {
 $("depChange").click(function(){});
}
// 删除社团
function deleteTeam() {}

$(document).ready(function(){
  teamSelector();
  showTeam();
  addTeam();
});

</script>

  </body>
</html>
